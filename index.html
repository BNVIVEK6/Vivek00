<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RB S7 ULTRA - Professional Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lottie-web@5.12.2/build/player/lottie.min.js"></script>
  <style>
    :root {
      --primary: #0b132b;
      --secondary: #1c2541;
      --accent: #3a506b;
      --highlight: #00f5d4;
      --highlight-alt: #5bc0be;
      --text-primary: #ffffff;
      --text-secondary: #c5d8d1;
      --win: #4CAF50;
      --loss: #f44336;
      --pending: #FFC107;
      --card-bg: rgba(28, 37, 65, 0.85);
      --main-bg: #0b132b;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--main-bg);
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 35%, rgba(5, 113, 255, 0.15) 0%, transparent 25%),
        radial-gradient(circle at 75% 15%, rgba(0, 245, 212, 0.1) 0%, transparent 25%),
        radial-gradient(circle at 85% 70%, rgba(90, 0, 226, 0.15) 0%, transparent 25%);
      z-index: -1;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 15px 0;
      position: relative;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-text {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 2.2rem;
      color: var(--highlight);
      text-shadow: 0 0 10px rgba(0, 245, 212, 0.5), 0 0 20px rgba(0, 245, 212, 0.2);
      letter-spacing: 2px;
    }

    .logo-subtitle {
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
      color: var(--text-secondary);
      letter-spacing: 3px;
    }

    .version-badge {
      background: linear-gradient(135deg, rgba(58, 80, 107, 0.8), rgba(28, 37, 65, 0.8));
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--highlight);
      border: 1px solid rgba(0, 245, 212, 0.3);
    }

    .card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(58, 80, 107, 0.3);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--highlight), var(--highlight-alt), var(--highlight));
      background-size: 200% 100%;
      animation: gradientMove 3s linear infinite;
    }

    .card-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--highlight);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title i {
      font-size: 1.1rem;
      background: rgba(0, 245, 212, 0.2);
      width: 36px;
      height: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .two-columns {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .two-columns {
        grid-template-columns: 1fr;
      }
    }

    .status-box {
      background: rgba(11, 19, 43, 0.6);
      border-radius: 12px;
      padding: 15px;
      position: relative;
      border: 1px solid rgba(58, 80, 107, 0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      overflow: hidden;
    }

    .status-box::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--highlight-alt), transparent);
    }

    .status-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .status-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--text-primary);
    }

    .prediction-container {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      position: relative;
      padding-bottom: 20px;
    }

    .prediction-divider {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      height: 80%;
      width: 1px;
      background: linear-gradient(to bottom, transparent, rgba(0, 245, 212, 0.5), transparent);
    }

    .prediction-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 15px 30px;
      position: relative;
    }

    .prediction-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 10px;
      letter-spacing: 1px;
    }

    .prediction-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.2rem;
      font-weight: bold;
    }

    .prediction-value.primary {
      color: var(--highlight);
      text-shadow: 0 0 10px rgba(0, 245, 212, 0.5);
    }

    .prediction-value.secondary {
      color: var(--highlight-alt);
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      color: var(--text-secondary);
    }

    .input-field {
      width: 100%;
      background: rgba(11, 19, 43, 0.7);
      border: 1px solid rgba(58, 80, 107, 0.5);
      color: var(--highlight);
      padding: 12px 15px;
      border-radius: 8px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      text-align: center;
    }

    .progress-container {
      margin-top: 15px;
      position: relative;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .progress-bar {
      height: 6px;
      background: rgba(11, 19, 43, 0.7);
      border-radius: 3px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      width: 75%;
      background: linear-gradient(90deg, var(--highlight), var(--highlight-alt));
      border-radius: 3px;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.1) 50%, 
        transparent 100%
      );
      animation: shimmer 1.5s infinite;
    }

    .history-list {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(11, 19, 43, 0.5);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 12px;
      border-left: 3px solid var(--accent);
      position: relative;
      overflow: hidden;
    }

    .history-item.win {
      border-left-color: var(--win);
    }

    .history-item.win::before {
      background: rgba(76, 175, 80, 0.1);
    }

    .history-item.loss {
      border-left-color: var(--loss);
    }

    .history-item.loss::before {
      background: rgba(244, 67, 54, 0.1);
    }

    .history-item.pending {
      border-left-color: var(--pending);
    }

    .history-item.pending::before {
      background: rgba(255, 193, 7, 0.1);
    }

    .history-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(58, 80, 107, 0.1);
      z-index: 0;
    }

    .history-content {
      flex: 1;
      position: relative;
      z-index: 1;
    }

    .history-period {
      font-family: 'Orbitron', sans-serif;
      font-weight: 500;
      margin-bottom: 5px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .history-predictions {
      display: flex;
      gap: 15px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .history-result {
      font-size: 0.9rem;
    }

    .prediction-tag {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      border-radius: 4px;
      padding: 2px 8px;
      background: rgba(58, 80, 107, 0.3);
      font-size: 0.85rem;
    }

    .result-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .result-icon {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 5px;
      position: relative;
    }

    .result-icon.win {
      background: rgba(76, 175, 80, 0.2);
      color: var(--win);
      animation: pulse 1.5s infinite;
    }

    .result-icon.loss {
      background: rgba(244, 67, 54, 0.2);
      color: var(--loss);
      animation: pulse 1.5s infinite;
    }

    .result-icon.pending {
      background: rgba(255, 193, 7, 0.2);
      color: var(--pending);
    }

    .result-icon.pending i {
      animation: spin 1.5s linear infinite;
    }

    .result-text {
      font-size: 0.75rem;
      font-weight: 600;
    }

    .result-text.win {
      color: var(--win);
    }

    .result-text.loss {
      color: var(--loss);
    }

    .result-text.pending {
      color: var(--pending);
    }

    .action-btn {
      background: rgba(58, 80, 107, 0.6);
      color: var(--text-primary);
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
      position: relative;
      overflow: hidden;
      width: 100%;
      transition: all 0.3s ease;
    }

    .action-btn:hover {
      background: rgba(58, 80, 107, 0.8);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .action-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.1), 
        transparent
      );
      transition: all 0.6s ease;
    }

    .action-btn:hover::before {
      left: 100%;
    }

    .danger-btn {
      background: rgba(244, 67, 54, 0.3);
      color: var(--loss);
    }

    .danger-btn:hover {
      background: rgba(244, 67, 54, 0.4);
    }

    .chart-container {
      width: 100%;
      height: 200px;
      margin-top: 20px;
    }

    .badge {
      display: inline-flex;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-left: 5px;
      align-items: center;
      gap: 3px;
    }

    .badge.success {
      background: rgba(76, 175, 80, 0.2);
      color: var(--win);
    }

    .badge.danger {
      background: rgba(244, 67, 54, 0.2);
      color: var(--loss);
    }

    .badge.warning {
      background: rgba(255, 193, 7, 0.2);
      color: var(--pending);
    }

    .stat-container {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .stat-item {
      background: rgba(11, 19, 43, 0.6);
      border-radius: 10px;
      padding: 12px;
      flex: 1;
      min-width: 110px;
      border: 1px solid rgba(58, 80, 107, 0.5);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .settings {
      position: absolute;
      top: 15px;
      right: 15px;
      display: flex;
      gap: 10px;
    }

    .settings-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(11, 19, 43, 0.7);
      border: 1px solid rgba(58, 80, 107, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .settings-btn:hover {
      color: var(--highlight);
      transform: translateY(-2px);
    }

    .footer {
      text-align: center;
      padding: 20px 0;
      margin-top: 30px;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .footer span {
      color: var(--highlight);
      font-weight: 600;
    }

    .win-animation-container, .loss-animation-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 200px;
      height: 200px;
      z-index: 1000;
      pointer-events: none;
      display: none;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(11, 19, 43, 0.9);
      border-left: 3px solid var(--highlight);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateX(150%);
      transition: transform 0.3s ease;
      backdrop-filter: blur(5px);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification-icon {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .notification-content {
      flex: 1;
    }

    .notification-title {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .notification-message {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .prediction-announcement {
      background: rgba(11, 19, 43, 0.7);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border: 1px solid rgba(0, 245, 212, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .announcement-text {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      color: var(--highlight);
      text-align: center;
    }

    .streak-counter {
      position: absolute;
      top: -10px;
      right: -10px;
      background: var(--highlight);
      color: var(--primary);
      font-weight: bold;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 0.8rem;
    }

    .trend-indicator {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 5px;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .trend-indicator i {
      font-size: 0.9rem;
    }

    .trend-up {
      color: var(--win);
    }

    .trend-down {
      color: var(--loss);
    }

    .trend-neutral {
      color: var(--text-secondary);
    }

    /* Animations */
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .loading-animation {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--highlight);
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo-container">
        <div>
          <h1 class="logo-text">RB S7 ULTRA</h1>
          <div class="logo-subtitle">VIVEK SPECIAL SERVER</div>
        </div>
        <div class="version-badge">PRO EDITION</div>
      </div>
      
      <div class="settings">
        <button class="settings-btn" id="soundToggle" title="Toggle Sound">
          <i class="fas fa-volume-up"></i>
        </button>
        <button class="settings-btn" id="themeToggle" title="Toggle Theme">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </header>

    <main>
      <div class="card">
        <h2 class="card-title"><i class="fas fa-brain"></i> AI PREDICTION CENTER</h2>
        
        <div class="two-columns">
          <div>
            <div class="input-group">
              <label class="input-label"><i class="fas fa-hashtag"></i> PERIOD ID</label>
              <input type="text" id="periodDisplay" class="input-field" value="-" readonly />
            </div>
            
            <div class="input-group">
              <label class="input-label"><i class="fas fa-clock"></i> CURRENT TIME</label>
              <input type="text" id="timeDisplay" class="input-field" value="-" readonly />
            </div>
            
            <div class="prediction-announcement">
              <div class="loading-animation" id="predictionLoader"></div>
              <div class="announcement-text">AI ANALYZING PATTERN...</div>
            </div>
          </div>
          
          <div class="status-box">
            <div class="status-label">SERVER STATUS</div>
            <div class="status-value">
              <i class="fas fa-circle" style="color: #4caf50; font-size: 0.6rem;"></i> CONNECTED
            </div>
            <div class="trend-indicator">
              <i class="fas fa-signal"></i> Signal Strength: Excellent
            </div>
            <div class="streak-counter" id="streakCounter">0</div>
          </div>
        </div>
        
        <div class="prediction-container">
          <div class="prediction-item">
            <div class="prediction-label">AI PREDICTION</div>
            <div class="prediction-value primary" id="predictionDisplay">-</div>
          </div>
          
          <div class="prediction-divider"></div>
          
          <div class="prediction-item">
            <div class="prediction-label">NUMBER PREDICTION</div>
            <div class="prediction-value secondary" id="oppositeNumberDisplay">-</div>
          </div>
        </div>
        
        <div class="progress-container">
          <div class="progress-label">
            <span>AI Confidence Level</span>
            <span id="confidenceLevel">75%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="confidenceFill"></div>
          </div>
          <div style="text-align: center; margin-top: 12px; font-size: 0.85rem; color: var(--text-secondary);">
            <i class="fas fa-robot"></i> ADVANCED PATTERN RECOGNITION SYSTEM V3.2
          </div>
        </div>
      </div>
      
      <div class="card">
        <h2 class="card-title"><i class="fas fa-chart-line"></i> PERFORMANCE ANALYTICS</h2>
        
        <div class="grid">
          <div class="status-box">
            <div class="status-label">WIN RATE</div>
            <div class="status-value" id="accuracy">0%</div>
            <div class="trend-indicator" id="accuracyTrend">
              <i class="fas fa-equals"></i> Stable
            </div>
          </div>
          
          <div class="status-box">
            <div class="status-label">TOTAL WIN</div>
            <div class="status-value" id="wins">0</div>
            <div class="trend-indicator" id="winTrend">
              <i class="fas fa-equals"></i> Stable
            </div>
          </div>
          
          <div class="status-box">
            <div class="status-label">TOTAL LOSS</div>
            <div class="status-value" id="losses">0</div>
            <div class="trend-indicator" id="lossTrend">
              <i class="fas fa-equals"></i> Stable
            </div>
          </div>
          
          <div class="status-box">
            <div class="status-label">CURRENT STREAK</div>
            <div class="status-value" id="streak">0</div>
            <div class="trend-indicator" id="streakTrend">
              <i class="fas fa-equals"></i> Stable
            </div>
          </div>
        </div>
        
        <div class="chart-container">
          <canvas id="performanceChart"></canvas>
        </div>
      </div>
      
      <div class="two-columns">
        <div class="card">
          <h2 class="card-title"><i class="fas fa-history"></i> PREDICTION HISTORY</h2>
          
          <div class="history-list" id="historyContainer">
            <!-- History items will be dynamically added here -->
          </div>
          
          <button class="action-btn danger-btn" id="clearHistoryBtn">
            <i class="fas fa-trash-alt"></i> DELETE ALL HISTORY
          </button>
        </div>
        
        <div class="card">
          <h2 class="card-title"><i class="fas fa-analytics"></i> TREND ANALYSIS</h2>
          
          <div class="stat-container">
            <div class="stat-item">
              <div class="stat-label">BIG</div>
              <div class="stat-value" id="bigCount">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">SMALL</div>
              <div class="stat-value" id="smallCount">0</div>
            </div>
          </div>
          
          <div class="chart-container" style="height: 150px;">
            <canvas id="distributionChart"></canvas>
          </div>
          
          <div class="stat-container">
            <div class="stat-item">
              <div class="stat-label">LAST RESULTS</div>
              <div id="lastResults" style="font-family: 'Orbitron'; margin-top: 8px; font-size: 1.2rem;">-</div>
            </div>
          </div>
          
          <div class="prediction-announcement" style="margin-top: 15px;">
            <div class="announcement-text" id="trendAdvice">Waiting for data...</div>
          </div>
        </div>
      </div>
    </main>
    
    <div class="footer">
      CREATED BY <span>VIVEK BHAI</span> | PROFESSIONAL EDITION 2023
    </div>
  </div>
  
  <!-- Animations and Notifications -->
  <div class="win-animation-container" id="winAnimation"></div>
  <div class="loss-animation-container" id="lossAnimation"></div>
  
  <div class="notification" id="notification">
    <div class="notification-icon" id="notificationIcon">
      <i class="fas fa-info-circle"></i>
    </div>
    <div class="notification-content">
      <div class="notification-title" id="notificationTitle">Title</div>
      <div class="notification-message" id="notificationMessage">Message</div>
    </div>
  </div>

  <script>
    // Data Storage and State Management
    let historyData = [];
    let lastFetchedPeriod = null;
    let lastResult = null;
    let lastPrediction = null;
    let lastStatus = null;
    let lastOppositeNumber = null;
    let globalPrediction = null;
    let streak = 0;
    let soundEnabled = true;
    let darkMode = true;
    let previousStats = { wins: 0, losses: 0 };
    
    // Initialize Charts
    let performanceChart;
    let distributionChart;
    
    // Sound Effects
    const winSound = new Audio("https://assets.mixkit.co/active_storage/sfx/2019/preview-2019.mp3");
    const lossSound = new Audio("https://assets.mixkit.co/active_storage/sfx/209/preview-209.mp3");
    const predictionSound = new Audio("https://assets.mixkit.co/active_storage/sfx/1321/preview-1321.mp3");

    // Initialize Lottie Animations
    let winAnimation;
    let lossAnimation;

    // DOM Ready
    document.addEventListener('DOMContentLoaded', function() {
      initializeCharts();
      initializeAnimations();
      
      // Setup event listeners
      document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
      document.getElementById('soundToggle').addEventListener('click', toggleSound);
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
      
      // Start the application
      updateTime();
      setInterval(updatePrediction, 5000);
      setInterval(updateTime, 1000);
      
      // Show welcome notification
      showNotification('System Ready', 'AI Prediction System has been initialized', 'info');
    });

    function initializeAnimations() {
      winAnimation = lottie.loadAnimation({
        container: document.getElementById('winAnimation'),
        renderer: 'svg',
        loop: false,
        autoplay: false,
        path: 'https://assets10.lottiefiles.com/packages/lf20_touohxv0.json'
      });
      
      lossAnimation = lottie.loadAnimation({
        container: document.getElementById('lossAnimation'),
        renderer: 'svg',
        loop: false,
        autoplay: false,
        path: 'https://assets2.lottiefiles.com/packages/lf20_qpwbiyxf.json'
      });
    }

    function initializeCharts() {
      // Performance Chart
      const perfCtx = document.getElementById('performanceChart').getContext('2d');
      performanceChart = new Chart(perfCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            {
              label: 'Win Rate',
              data: [],
              borderColor: '#00f5d4',
              backgroundColor: 'rgba(0, 245, 212, 0.1)',
              tension: 0.4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#c5d8d1'
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                color: '#c5d8d1'
              }
            }
          }
        }
      });
      
      // Distribution Chart
      const distCtx = document.getElementById('distributionChart').getContext('2d');
      distributionChart = new Chart(distCtx, {
        type: 'doughnut',
        data: {
          labels: ['BIG', 'SMALL'],
          datasets: [{
            data: [0, 0],
            backgroundColor: [
              'rgba(0, 245, 212, 0.7)',
              'rgba(91, 192, 190, 0.7)'
            ],
            borderColor: [
              '#00f5d4',
              '#5bc0be'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: '#c5d8d1'
              }
            }
          }
        }
      });
    }

    function getOppositeNumber(prediction) {
      const small = [6, 8, 5, 7, 9, 8, 5, 6, 9, 7];
      const big = [3, 4, 2, 0, 1, 3, 2, 4, 0, 1];
      let arr = prediction === "BIG" ? small : big;
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function getRandomConfidence() {
      return Math.floor(Math.random() * 31) + 70; // Random value between 70-100
    }

    function ultraAIPredict(history) {
      // Show prediction in progress
      document.getElementById('predictionLoader').style.display = 'inline-block';
      document.getElementsByClassName('announcement-text')[0].innerText = 'AI ANALYZING PATTERN...';
      
      return new Promise(resolve => {
        setTimeout(() => {
          // Analyze the recent history with updated algorithm
          if (history.length < 3) {
            resolve({ 
              prediction: Math.random() > 0.5 ? "BIG" : "SMALL",
              confidence: getRandomConfidence()
            });
            return;
          }
          
          let recentResults = history.filter(h => h.result !== "-").slice(0, 5);
          let bigCount = 0;
          let smallCount = 0;
          let weight = 1;
          
          for (let i = recentResults.length - 1; i >= 0; i--) {
            let result = recentResults[i];
            if (result.result >= 5) {
              bigCount += weight;
            } else {
              smallCount += weight;
            }
            weight *= 1.35; // Increase weight for more recent results
          }
          
          // Add some pattern analysis
          let lastThree = recentResults.slice(0, 3);
          let allBig = lastThree.every(r => r.result >= 5);
          let allSmall = lastThree.every(r => r.result < 5);
          let alternating = lastThree.length >= 3 && 
                          ((lastThree[0].result >= 5 && lastThree[1].result < 5 && lastThree[2].result >= 5) || 
                           (lastThree[0].result < 5 && lastThree[1].result >= 5 && lastThree[2].result < 5));
          
          let prediction;
          let confidence;
          
          if (allBig) {
            // If we've had 3 BIG in a row, higher chance of switching to SMALL
            prediction = Math.random() < 0.65 ? "SMALL" : "BIG";
            confidence = Math.floor(Math.random() * 16) + 80; // 80-95
          } else if (allSmall) {
            // If we've had 3 SMALL in a row, higher chance of switching to BIG
            prediction = Math.random() < 0.65 ? "BIG" : "SMALL";
            confidence = Math.floor(Math.random() * 16) + 80; // 80-95
          } else if (alternating) {
            // If alternating pattern detected, continue the pattern
            prediction = lastThree[0].result < 5 ? "BIG" : "SMALL";
            confidence = Math.floor(Math.random() * 21) + 75; // 75-95
          } else {
            // Otherwise use weighted frequency
            prediction = bigCount > smallCount ? "BIG" : "SMALL";
            // Add some randomness to break patterns sometimes
            if (Math.random() < 0.15) {
              prediction = prediction === "BIG" ? "SMALL" : "BIG";
              confidence = Math.floor(Math.random() * 20) + 60; // 60-80
            } else {
              confidence = Math.floor(Math.random() * 21) + 70; // 70-90
            }
          }
          
          // Make it visually appealing by showing the "thinking" progress
          document.getElementById('predictionLoader').style.display = 'none';
          document.getElementsByClassName('announcement-text')[0].innerText = 'AI PREDICTION READY';
          
          if (soundEnabled) {
            predictionSound.play();
          }
          
          resolve({ prediction, confidence });
        }, 1500);
      });
    }

    function updateLastStatus(actualNumber) {
      const match = actualNumber == lastOppositeNumber || (actualNumber >= 5 ? 'BIG' : 'SMALL') === lastPrediction;
      lastResult = actualNumber >= 5 ? 'BIG' : 'SMALL';
      lastStatus = match ? 'WIN' : 'LOSS';
      
      // Update streak
      if (lastStatus === 'WIN') {
        streak++;
      } else {
        streak = 0;
      }
      
      document.getElementById('streakCounter').innerText = streak;
      
      // Show animation and play sound for result
      if (lastStatus === 'WIN') {
        showWinAnimation();
        if (soundEnabled) winSound.play();
      } else {
        showLossAnimation();
        if (soundEnabled) lossSound.play();
      }
      
      // Show notification
      showNotification(
        lastStatus === 'WIN' ? 'Prediction Win!' : 'Prediction Loss',
        `Result: ${actualNumber} (${lastResult}) - Your prediction was ${lastPrediction}`,
        lastStatus === 'WIN' ? 'success' : 'danger'
      );
    }

    async function fetchGameResult() {
      try {
        let response = await fetch("https://api.bdg88zf.com/api/webapi/GetNoaverageEmerdList", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            pageSize: 10,
            pageNo: 1,
            typeId: 1,
            language: 0,
            random: "4a0522c6ecd8410496260e686be2a57c",
            signature: "334B5E70A0C9B8918B0B15E517E2069C",
            timestamp: Math.floor(Date.now() / 1000)
          })
        });
        let data = await response.json();
        return data?.data?.list?.[0] || null;
      } catch (e) {
        console.error("API Error", e);
        showNotification("API Error", "Failed to fetch game data. Retrying...", "danger");
        return null;
      }
    }

    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', { hour12: false });
      document.getElementById("timeDisplay").value = timeString;
    }

    async function updatePrediction() {
      let result = await fetchGameResult();
      if (!result || result.issueNumber === lastFetchedPeriod) return;

      if (historyData.length > 0 && historyData[0].resultStatus === "Pending") {
        const actualNumber = Number(result.number);
        updateLastStatus(actualNumber);
        historyData[0].result = actualNumber;
        historyData[0].resultStatus = lastStatus;
      }

      const aiDecision = await ultraAIPredict(historyData);
      lastPrediction = aiDecision.prediction;
      lastOppositeNumber = getOppositeNumber(lastPrediction);
      globalPrediction = lastPrediction;
      
      // Update confidence indicator
      document.getElementById('confidenceLevel').innerText = `${aiDecision.confidence}%`;
      document.getElementById('confidenceFill').style.width = `${aiDecision.confidence}%`;

      let nextPeriodFull = (BigInt(result.issueNumber) + 1n).toString();
      let nextPeriod = nextPeriodFull.slice(-4);

      document.getElementById("periodDisplay").value = nextPeriod;
      document.getElementById("predictionDisplay").innerText = globalPrediction;
      document.getElementById("oppositeNumberDisplay").innerText = lastOppositeNumber;

      historyData.unshift({
        period: nextPeriod,
        prediction: globalPrediction,
        oppositeNumber: lastOppositeNumber,
        result: "-",
        resultStatus: "Pending",
        timestamp: Date.now()
      });

      updateHistory();
      updateStats();
      updateCharts();
      lastFetchedPeriod = result.issueNumber;
    }

    function updateHistory() {
      const container = document.getElementById("historyContainer");
      container.innerHTML = historyData.map((item, index) => {
        let statusClass = item.resultStatus === "WIN" ? "win" : 
                          item.resultStatus === "LOSS" ? "loss" : "pending";
        
        let statusIcon = item.resultStatus === "WIN" ? "fa-check" : 
                        item.resultStatus === "LOSS" ? "fa-xmark" : 
                        "fa-spinner fa-spin";
        
        return `
        <div class="history-item ${statusClass}">
          <div class="history-content">
            <div class="history-period">
              <i class="fas fa-hashtag"></i> ${item.period}
            </div>
            <div class="history-predictions">
              <div class="prediction-tag">
                <i class="fas fa-brain"></i> ${item.prediction}
              </div>
              <div class="prediction-tag">
                <i class="fas fa-dice"></i> ${item.oppositeNumber}
              </div>
              <div class="prediction-tag">
                <i class="fas fa-arrow-right"></i> ${item.result !== "-" ? item.result : "..."}
              </div>
            </div>
          </div>
          <div class="result-indicator">
            <div class="result-icon ${statusClass}">
              <i class="fas ${statusIcon}"></i>
            </div>
            <div class="result-text ${statusClass}">
              ${item.resultStatus}
            </div>
          </div>
        </div>`;
      }).join("");
    }

    function updateStats() {
      // Store previous stats for trend comparison
      previousStats = {
        wins: parseInt(document.getElementById("wins").textContent) || 0,
        losses: parseInt(document.getElementById("losses").textContent) || 0,
        accuracy: parseFloat(document.getElementById("accuracy").textContent) || 0
      };
      
      const wins = historyData.filter(item => item.resultStatus === "WIN").length;
      const losses = historyData.filter(item => item.resultStatus === "LOSS").length;
      const total = wins + losses;
      const accuracy = total > 0 ? ((wins / total) * 100).toFixed(2) : 0;
      
      // Get and count the last results (excluding pending)
      const completedResults = historyData
        .filter(h => h.result !== "-")
        .slice(0, 5);
        
      const lastResults = completedResults
        .map(h => h.result)
        .join(", ") || "-";
        
      const bigCount = completedResults.filter(h => h.result >= 5).length;
      const smallCount = completedResults.filter(h => h.result < 5).length;

      document.getElementById("wins").textContent = wins;
      document.getElementById("losses").textContent = losses;
      document.getElementById("accuracy").textContent = `${accuracy}%`;
      document.getElementById("streak").textContent = streak;
      document.getElementById("lastResults").textContent = lastResults;
      document.getElementById("bigCount").textContent = bigCount;
      document.getElementById("smallCount").textContent = smallCount;
      
      // Update trend indicators
      updateTrendIndicator("accuracyTrend", accuracy, previousStats.accuracy);
      updateTrendIndicator("winTrend", wins, previousStats.wins);
      updateTrendIndicator("lossTrend", losses, previousStats.losses, true); // Reversed logic for losses
      updateTrendIndicator("streakTrend", streak, parseInt(document.getElementById("streak").textContent) || 0);
      
      // Update trend advice
      updateTrendAdvice(bigCount, smallCount, completedResults);
    }
    
    function updateTrendIndicator(elementId, current, previous, reverse = false) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      let icon, text, className;
      
      if (current > previous) {
        icon = reverse ? "fa-arrow-down" : "fa-arrow-up";
        text = reverse ? "Decreasing" : "Improving";
        className = reverse ? "trend-down" : "trend-up";
      } else if (current < previous) {
        icon = reverse ? "fa-arrow-up" : "fa-arrow-down";
        text = reverse ? "Increasing" : "Declining";
        className = reverse ? "trend-up" : "trend-down";
      } else {
        icon = "fa-equals";
        text = "Stable";
        className = "trend-neutral";
      }
      
      element.innerHTML = `<i class="fas ${icon}"></i> ${text}`;
      element.className = `trend-indicator ${className}`;
    }
    
    function updateTrendAdvice(bigCount, smallCount, recentResults) {
      const trendAdvice = document.getElementById("trendAdvice");
      
      if (recentResults.length < 3) {
        trendAdvice.innerText = "Waiting for more data...";
        return;
      }
      
      // Check for patterns
      const lastThree = recentResults.slice(0, 3).map(r => r.result >= 5 ? "BIG" : "SMALL");
      const allSame = lastThree.every(r => r === lastThree[0]);
      const alternating = lastThree[0] !== lastThree[1] && lastThree[1] !== lastThree[2];
      
      if (allSame) {
        trendAdvice.innerText = `Strong ${lastThree[0]} trend detected. Pattern may reverse soon.`;
      } else if (alternating) {
        trendAdvice.innerText = `Alternating pattern detected. Next likely: ${lastThree[0] === "BIG" ? "SMALL" : "BIG"}.`;
      } else if (bigCount > smallCount * 2) {
        trendAdvice.innerText = "Heavily BIG dominant. Consider pattern change.";
      } else if (smallCount > bigCount * 2) {
        trendAdvice.innerText = "Heavily SMALL dominant. Consider pattern change.";
      } else {
        trendAdvice.innerText = "Mixed patterns detected. Maintain balanced strategy.";
      }
    }
    
    function updateCharts() {
      // Update Performance Chart (win rate over time)
      const labels = [];
      const data = [];
      const dataPoints = Math.min(historyData.length, 20);
      
      for (let i = 0; i < dataPoints; i++) {
        const subset = historyData.slice(i);
        const wins = subset.filter(item => item.resultStatus === "WIN").length;
        const total = subset.filter(item => item.resultStatus === "WIN" || item.resultStatus === "LOSS").length;
        const winRate = total > 0 ? (wins / total) * 100 : 0;
        
        labels.unshift(`${dataPoints - i}`);
        data.unshift(winRate.toFixed(1));
      }
      
      performanceChart.data.labels = labels;
      performanceChart.data.datasets[0].data = data;
      performanceChart.update();
      
      // Update Distribution Chart (BIG vs SMALL)
      const completedResults = historyData.filter(h => h.result !== "-");
      const bigCount = completedResults.filter(h => parseInt(h.result) >= 5).length;
      const smallCount = completedResults.filter(h => parseInt(h.result) < 5).length;
      
      distributionChart.data.datasets[0].data = [bigCount, smallCount];
      distributionChart.update();
    }

    function showWinAnimation() {
      const container = document.getElementById('winAnimation');
      container.style.display = 'block';
      winAnimation.goToAndPlay(0);
      
      setTimeout(() => {
        container.style.display = 'none';
      }, 2000);
    }

    function showLossAnimation() {
      const container = document.getElementById('lossAnimation');
      container.style.display = 'block';
      lossAnimation.goToAndPlay(0);
      
      setTimeout(() => {
        container.style.display = 'none';
      }, 2000);
    }

    function showNotification(title, message, type) {
      const notification = document.getElementById('notification');
      const notificationTitle = document.getElementById('notificationTitle');
      const notificationMessage = document.getElementById('notificationMessage');
      const notificationIcon = document.getElementById('notificationIcon');
      
      let iconClass = 'fa-info-circle';
      let iconColor = '#3a506b';
      
      switch(type) {
        case 'success':
          iconClass = 'fa-check-circle';
          iconColor = '#4CAF50';
          break;
        case 'danger':
          iconClass = 'fa-exclamation-triangle';
          iconColor = '#f44336';
          break;
        case 'warning':
          iconClass = 'fa-exclamation-circle';
          iconColor = '#FFC107';
          break;
      }
      
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      notificationIcon.innerHTML = `<i class="fas ${iconClass}"></i>`;
      notificationIcon.style.color = iconColor;
      
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 5000);
    }

    function deleteHistory(index) {
      historyData.splice(index, 1);
      updateHistory();
      updateStats();
      updateCharts();
    }

    function clearHistory() {
      historyData = [];
      updateHistory();
      updateStats();
      updateCharts();
      showNotification('History Cleared', 'All prediction history has been deleted', 'info');
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      const icon = document.querySelector('#soundToggle i');
      icon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
      
      showNotification(
        soundEnabled ? 'Sound Enabled' : 'Sound Disabled',
        soundEnabled ? 'Sound effects will now play' : 'Sound effects have been muted',
        'info'
      );
    }

    function toggleTheme() {
      darkMode = !darkMode;
      const icon = document.querySelector('#themeToggle i');
      icon.className = darkMode ? 'fas fa-moon' : 'fas fa-sun';
      
      document.documentElement.style.setProperty('--main-bg', darkMode ? '#0b132b' : '#f0f7ff');
      document.documentElement.style.setProperty('--card-bg', darkMode ? 'rgba(28, 37, 65, 0.85)' : 'rgba(255, 255, 255, 0.85)');
      document.documentElement.style.setProperty('--text-primary', darkMode ? '#ffffff' : '#0b132b');
      document.documentElement.style.setProperty('--text-secondary', darkMode ? '#c5d8d1' : '#3a506b');
      
      // Also update chart colors
      const gridColor = darkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      const tickColor = darkMode ? '#c5d8d1' : '#3a506b';
      
      performanceChart.options.scales.y.grid.color = gridColor;
      performanceChart.options.scales.y.ticks.color = tickColor;
      performanceChart.options.scales.x.ticks.color = tickColor;
      performanceChart.update();
      
      distributionChart.options.plugins.legend.labels.color = tickColor;
      distributionChart.update();
      
      showNotification(
        darkMode ? 'Dark Mode' : 'Light Mode',
        `Theme switched to ${darkMode ? 'dark' : 'light'} mode`,
        'info'
      );
    }
  </script>
</body>
</html>
